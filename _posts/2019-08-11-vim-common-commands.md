---
title: Vim常用命令学习笔记
date: 2019-08-11 20:51:25 +0800
categories: [Vim]
tags: [vim]
---
Vim作为Linux下最常用的编辑器之一，非常强大也非常难用。Vim的功能太多不可能全部记住，因此在这里记录一些最常用的命令。

## 1.基本使用
打开/新建文件：`vim file.txt`

按`a`键进入插入模式，开始编辑文本，可使用方向键、`<Home>`, `<End>`, `<PgUp>`, `<PgDn>`等键移动光标

撤销：`u`

重做：`Ctrl+R`

按`<Esc>`键返回正常模式

退出编辑器：
* `:q` - 退出，如果修改了文件vim会提示
* `:wq`或`:x` - 保存并退出
* `:q!` - 放弃修改并退出

`:help` - 查看帮助，这里列出了所有帮助主题，可用`:help **.txt`查看具体主题的帮助

注：以下命令仅在正常模式下使用

## 2.移动光标
`[N] h` - 左

`[N] j` - 下

`[N] k` - 上

`[N] l` - 右

N是一个整数，默认为1

例如`h`是向左移动1个字符，`3j`是向下移动3行

`0` - 移动到本行第1个字符，同`<Home>`键

`^` - 移动到本行第1个非空字符

`$` - 移动到本行最后一个字符，同`<End>`键

`[N] G` - 移动到第N行（默认最后一行）第1个非空字符

`[N] gg` - 移动到第N行（默认第1行）第1个非空字符

`[N] w` - 向右移动N个单词，光标在单词开头

`[N] e` - 向右移动N个单词，光标在单词结尾

`[N] b` - 向左移动N个单词，光标在单词开头

N默认为1

`[N] f{char}` - 移动到从光标位置（不包括当前位置）向右字符char第N次出现的地方

`[N] F{char}` - 移动到从光标位置（不包括当前位置）向左字符char第N次出现的地方

N默认为1

例如：[o]ccurrence -> `fc` -> o[c]currence -> `2fr` -> occur[r]ence -> `Fr` occu[r]rence

完整帮助文档：motion.txt

## 3.删除
`[N] x` - 删除光标下以及后面的共N个字符，x同`<Del>`键和`dl`

`d{motion}` - 删除motion移动过的文本，motion可以是任何移动光标的命令

`[N] dd` - 删除N行

`[N] r{char}` - 将光标下以及后面的N个字符替换为char

`:[range]d` - 删除指定范围内的行，range的语法见下一节“替换”

例如：

ab[c]defg -> `3x` -> ab[f]g

ab[c]defg -> `3rz` -> abzz[z]fg

`d$`删除光标到当前行尾之间的内容

`dG`删除当前行到最后一行的内容

`d2fz`删除光标到第2个z的全部内容

完整帮助文档：change.txt（1~3节）

## 4.查找和替换
`/{pattern}` - 向前查找给定的模式，按`<Enter>`键将光标移动到第1个匹配的位置，`n` - 查找下一个，`N` - 查找上一个

大小写敏感：在模式开头或结尾加入`\c`表示大小写不敏感，`\C`表示大小写敏感（默认）

例如：`/\cfoo`或`/foo\c`匹配foo, Foo, FOO等，`/foo`（或`/\Cfoo`、`/foo\C`）仅匹配foo

Vim支持正则表达式，但默认只有`. * ^ $`有特殊含义，而其他字符仅表示其字面含义，若要使用其特殊含义要用`\`转义（magic模式）。如果不想输入这么多反斜杠，可以在模式开头加入`\v`，则认为除了数字、字母和下划线之外的字符都有特殊含义，而要使用其字面含义时需要转义。（详见帮助文档pattern.txt的Magic一节）

例如：

`/\d*`  查找0个或多个数字

`/\(o\|i\)f`或`/\v(o|i)f`  查找of或if

`/(\d\{3})\d\{8}`或`/\v\(\d{3}\)\d{8}`  查找(010)12345678格式的电话号码

Vim模式与正则表达式语法的区别：

（1）单词开头和结尾

正则表达式：`\b`，Vim: `\<`和`\>`

注意：不可与`\v`同时使用

（2）懒惰匹配

|含义|正则表达式|Vim|
|--|--|--|
|重复n到m次，尽可能少|`{n, m}?`|`\{-n, m}`|
|重复至少n次，尽可能少|`{n,}?`|`\{-n,}`|
|重复n次，尽可能少|`{n}?`|`\{-n}`|
|重复0次或更多，尽可能少|`*?`|`\{-}`|
|重复1次或更多，尽可能少|`+?`|`\{-1,}`|

若使用了`\v`则不需要开头的反斜杠

（3）零宽断言

|含义|正则表达式|Vim|
|--|--|--|
|后面能匹配表达式exp|`(?=exp)`|`\ze\(exp\)`|
|前面能匹配表达式exp|`(?<=exp)`|`\zs\(exp\)`|
|后面不能匹配表达式exp|`(?!exp)`|无|
|前面不能匹配表达式exp|`(?<!exp)`|无|

注意：不可与`\v`同时使用

例如：I'm singing while you're dancing.

`/\<\w\+\ze\(ing\>\)`  将匹配其中的sing和danc，等价于正则表达式`\b\w+(?=ing\b)`

`:[range]s/{pattern}/{string}/[flags]` - 对于指定范围内的每一行，将给定模式替换为给定字符串

模式的语法同上，替换字符串可像正则表达式一样使用`\0`, `\1`等表示匹配到的文本

对于`flags`，g表示替换所有，c表示确认每次替换（y - 替换，n - 不替换，a - 替换剩下的匹配，q或`<Esc>` - 停止替换），n表示统计匹配次数（并不真正替换）

对于`range`，省略表示当前行，n表示第n行，m,n表示第m~n行，%表示整个文件（完整语法见:help cmdline-ranges）

例如：

`:s/foo/bar/`  将当前行第一个foo替换为bar

`:5,10s/foo/bar/g` 将第5~10行所有的foo替换为bar

`:%s/\v"([^"]+)"/\1/gc`  将文件中所有带引号的单词的引号删除，并逐个确认

`:%s/\<foo\>/&/gn`  查找文件中单词foo的出现次数（全词匹配）

完整帮助文档：pattern.txt、change.txt（4.2节）

## 5.复制粘贴
`:reg` - 查看所有寄存器的内容，vim的每个寄存器相当于一个剪贴板

`:reg {name}` - 查看指定寄存器的内容，寄存器的名字是一个字符，如0-9.#%*等

`["x]y{motion}` - 复制motion移动过的文本到寄存器x

`[N] ["x]yy` - 复制N行的内容到寄存器x

`["x]p` - 将寄存器x的内容粘贴到光标后

`["x]P` - 将寄存器x的内容粘贴到光标前

例如：

ab[c]defg -> `"1y3l` -> ab[c]defg  ("1 = cde)

uvw[x]yz -> `"1p` -> uvwxcd[e]yz

uvw[x]yz -> `"1P` -> uvwcd[e]xyz

完整帮助文档：change.txt（第5节）

## 6.重复
`:[range]g/{pattern}/[cmd]` - 对范围内的所有匹配模式pattern行执行操作

`:[range]g!/{pattern}/[cmd]` - 对范围内的所有不匹配模式pattern行执行操作

`:[range]v/{pattern}/[cmd]` - 同:g!

range的语法同“替换”，默认为%，即整个文件

例如：

`:g/foo/d`  删除包含foo的所有行

完整帮助文档：repeat.txt

## 7.分割窗口
`:split [file]` - 将当前窗口分为上下两部分，若指定了文件名则打开指定的文件，否则查看同一文件

`:vsplit [file]` - 将当前窗口分为左右两部分，若指定了文件名则打开指定的文件，否则查看同一文件

`:new [file]` - 将当前窗口分为上下两部分，若指定了文件名则打开指定的文件，否则创建空文件

`:vnew [file]` - 将当前窗口分为左右两部分，若指定了文件名则打开指定的文件，否则创建空文件

`:close[!]` - 关闭当前窗口，若添加`!`则放弃修改

`:only[!]` - 关闭其他窗口，若添加`!`则放弃修改

`Ctrl+W w` - 切换窗口

完整帮助文档：windows.txt

## 参考
* [vim 操作命令大全](https://blog.csdn.net/weixin_37657720/article/details/80645991)
* [Vim的正则表达式](https://www.jianshu.com/p/3abd6fbc3322)
